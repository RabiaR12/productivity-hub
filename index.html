<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Productivity Hub</title>

  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- ✅ FIX: hide Time Range + Refresh ONLY when Incident is active
       (JS will toggle: body.incident-mode) -->
  <style>
    body.incident-mode .top-actions{ display:none !important; }
  </style>
</head>

<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="side-brand">
        <div class="side-logo">PH</div>
        <div class="side-title">
          <div class="side-name">Productivity Hub</div>
          <div class="side-sub">Amazon Office Console</div>
        </div>
      </div>

      <!-- ✅ ONLY 2 main sections -->
      <nav class="side-nav" id="mainNav" aria-label="Main Navigation">
        <button class="side-item active" data-section="productivity" type="button" aria-selected="true">
          <span class="bullet"></span> Productivity
        </button>
        <button class="side-item" data-section="incident" type="button" aria-selected="false">
          <span class="bullet"></span> Incident Management
        </button>
      </nav>

      <div class="side-footer">
        <div class="live-pill">
          <span class="dot"></span>
          <span id="liveLabel">Live</span>
          <span class="sep">•</span>
          <span id="lastUpdated">Updated just now</span>
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <!-- Topbar -->
      <header class="topbar">
        <div class="top-left">
          <div class="page-title" id="pageTitle">Productivity</div>
          <div class="page-sub" id="pageSub">Employee, Manager, and Amazon office asset insights.</div>
        </div>

        <!-- ✅ Will be hidden on Incident using body.incident-mode -->
        <div class="top-actions">
          <div class="chip">
            <span class="chip-label">Time Range</span>
            <select id="timeRange" class="select">
              <option value="7">Last 7 days</option>
              <option value="30" selected>Last 30 days</option>
              <option value="90">Last 90 days</option>
            </select>
          </div>
          <button id="refreshBtn" class="btn" type="button">Refresh</button>
        </div>
      </header>

      <!-- Global Loading Overlay -->
      <section class="panel">
        <div id="loadingOverlay" class="loading hidden" aria-hidden="true">
          <div class="loading-card">
            <div class="spinner"></div>
            <div>
              <div class="loading-title">Updating insights</div>
              <div class="loading-sub">Processing latest signals and recalculating trends…</div>
            </div>
          </div>
        </div>
      </section>

      <!-- =========================
           SECTION: PRODUCTIVITY
           ========================= -->
      <section class="section active" id="section-productivity" aria-label="Productivity Section">
        <!-- Sub-tabs -->
        <div class="subtabs" id="productivityTabs" role="tablist" aria-label="Productivity Tabs">
          <button class="subtab active" data-view="assets" role="tab" aria-selected="true" type="button">
            Assets
          </button>
          <button class="subtab" data-view="employee" role="tab" aria-selected="false" type="button">
            Employee
          </button>
          <button class="subtab" data-view="manager" role="tab" aria-selected="false" type="button">
            Manager
          </button>
        </div>

        <div class="viewwrap">
          <!-- ✅ Assets DEFAULT -->
          <div class="view active" id="view-assets" data-view="assets" role="tabpanel" aria-label="Assets View">
            <!-- Header row for Assets -->
            <div class="assets-head">
              <div>
                <div class="card-title" style="font-size:15px;">Amazon Office Assets</div>
                <div class="card-note">Utilization, availability, compliance, and location-level details.</div>
              </div>

              <div class="assets-controls">
                <div class="chip chip-compact">
                  <span class="chip-label">Office</span>
                  <select id="officeSelect" class="select">
                    <option value="all" selected>All Offices</option>
                    <option value="hq2">HQ2 (Arlington)</option>
                    <option value="seattle">Seattle</option>
                    <option value="nyc">New York</option>
                    <option value="austin">Austin</option>
                  </select>
                </div>

                <div class="chip chip-compact">
                  <span class="chip-label">Asset Type</span>
                  <select id="assetTypeSelect" class="select">
                    <option value="all" selected>All</option>
                    <option value="printers">Printers</option>
                    <option value="rooms">Conference Rooms</option>
                    <option value="zoom">Zoom Rooms</option>
                    <option value="desks">Hot Desks</option>
                    <option value="lockers">Lockers</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- ✅ KPIs (ALL IN ONE ROW – single container) -->
            <div class="kpis kpis-compact" id="assetsKpis" aria-label="Assets KPI Strip">
              <div class="kpi">
                <div class="kpi-label">Utilization</div>
                <div class="kpi-value"><span id="kpiAssetUtil">74</span><span class="kpi-unit">%</span></div>
                <div class="kpi-foot">Rolling 30 days</div>
              </div>

              <div class="kpi">
                <div class="kpi-label">Assets Online</div>
                <div class="kpi-value"><span id="kpiAssetsOnline">128</span></div>
                <div class="kpi-foot">Printers, rooms, devices</div>
              </div>

              <div class="kpi">
                <div class="kpi-label">Active Issues</div>
                <div class="kpi-value"><span id="kpiAssetIssues">6</span></div>
                <div class="kpi-foot">Needs attention</div>
              </div>

              <div class="kpi">
                <div class="kpi-label">Underutilized</div>
                <div class="kpi-value"><span id="kpiUnderUtil">14</span></div>
                <div class="kpi-foot">Below threshold</div>
              </div>

              <div class="kpi">
                <div class="kpi-label">Monitoring Uptime</div>
                <div class="kpi-value"><span id="kpiUptime">99.7</span><span class="kpi-unit">%</span></div>
                <div class="kpi-foot">Last 30 days</div>
              </div>

              <div class="kpi">
                <div class="kpi-label">Auto-Remediations</div>
                <div class="kpi-value"><span id="kpiAutoRemed">84</span></div>
                <div class="kpi-foot">This month</div>
              </div>

              <div class="kpi">
                <div class="kpi-label">Policy / Access Blocks</div>
                <div class="kpi-value"><span id="kpiPolicyBlocks">12</span></div>
                <div class="kpi-foot">Last 7 days</div>
              </div>

              <div class="kpi">
                <div class="kpi-label">Compliance Score</div>
                <div class="kpi-value"><span id="kpiCompliance">98.2</span><span class="kpi-unit">%</span></div>
                <div class="kpi-foot">Controls met</div>
              </div>

              <div class="kpi">
                <div class="kpi-label">Data Retention Flags</div>
                <div class="kpi-value"><span id="kpiRetentionFlags">3</span></div>
                <div class="kpi-foot">Needs review</div>
              </div>

              <div class="kpi">
                <div class="kpi-label">Signals Processed</div>
                <div class="kpi-value"><span id="kpiSignals">2.3</span><span class="kpi-unit">M</span></div>
                <div class="kpi-foot">Rolling month</div>
              </div>
            </div>

            <!-- Assets charts -->
            <div class="grid two" style="margin-top:16px;">
              <div class="card">
                <div class="card-head">
                  <div>
                    <div class="card-title">Utilization by Asset Type</div>
                    <div class="card-note">Higher = more in demand</div>
                  </div>
                </div>
                <div class="canvas-wrap tall">
                  <canvas id="chartAssetsUtil"></canvas>
                </div>
              </div>

              <div class="card">
                <div class="card-head">
                  <div>
                    <div class="card-title">Availability Snapshot</div>
                    <div class="card-note">Available vs in use vs offline</div>
                  </div>
                </div>
                <div class="canvas-wrap tall">
                  <canvas id="chartAssetsAvail"></canvas>
                </div>
              </div>
            </div>

            <div class="grid two" style="margin-top:16px;">
              <div class="card">
                <div class="card-head">
                  <div>
                    <div class="card-title">Issues by Category</div>
                    <div class="card-note">Printers • Rooms • Zoom • Desks</div>
                  </div>
                </div>
                <div class="canvas-wrap tall">
                  <canvas id="chartAssetsIssues"></canvas>
                </div>
                <div class="divider"></div>
                <div class="muted" style="font-size:12.5px; line-height:1.6;">
                  Highlights top problem areas for faster operational triage and prioritization.
                </div>
              </div>

              <div class="card">
                <div class="card-head">
                  <div>
                    <div class="card-title">Compliance & Governance Trend</div>
                    <div class="card-note">Control coverage and drift</div>
                  </div>
                </div>
                <div class="canvas-wrap tall">
                  <canvas id="chartAssetsCompliance"></canvas>
                </div>
                <div class="divider"></div>
                <div style="display:flex; gap:10px; flex-wrap:wrap;">
                  <span class="pill p-green">Encryption ✓ Active</span>
                  <span class="pill p-blue">Access Logs ✓ Active</span>
                  <span class="pill p-amber">Retention ⚠ <span id="pillRetentionCount">3</span> flags</span>
                </div>
              </div>
            </div>

            <div class="card" id="assetsCriticalAlert" style="margin-top:16px; border-left: 6px solid #ef4444; background: rgba(239,68,68,0.06);">
              <div class="card-head">
                <div>
                  <div class="card-title">Critical Alert</div>
                  <div class="card-note" id="assetsCriticalNote">
                    Multiple assets exceeded issue thresholds today — review and address within 24 hours.
                  </div>
                </div>
              </div>
            </div>

            <div class="grid two" style="margin-top:16px;">
              <div class="card">
                <div class="card-head">
                  <div>
                    <div class="card-title">Assets</div>
                    <div class="card-note">Click an item to view details</div>
                  </div>
                </div>

                <div class="divider"></div>

                <div class="assets-list" id="assetsList"></div>

                <div class="divider"></div>

                <div class="table">
                  <div class="trow thead" style="grid-template-columns: 1.2fr 1fr 1fr 1fr;">
                    <div>Area</div><div>Online</div><div>Issues</div><div>Notes</div>
                  </div>
                  <div id="assetsOpsRows"></div>
                </div>
              </div>

              <div class="card" id="assetDetailsCard">
                <div class="card-head">
                  <div>
                    <div class="card-title">Asset Details</div>
                    <div class="card-note" id="assetDetailsSub">Select an asset to view status and usage.</div>
                  </div>
                </div>

                <div class="divider"></div>

                <div id="assetDetails">
                  <div class="empty-state">
                    <div class="empty-title">No asset selected</div>
                    <div class="empty-sub">Choose a printer, room, or device from the list.</div>
                  </div>
                </div>

                <div class="divider"></div>

                <div class="grid" style="grid-template-columns: 1fr 1fr; gap:12px;">
                  <div class="card" style="box-shadow:none; background: rgba(59,130,246,0.10); border:1px solid rgba(59,130,246,0.22);">
                    <div style="font-weight:950; font-size:12.5px;">Recommended Action</div>
                    <div class="muted" style="font-size:12.5px; margin-top:6px; line-height:1.6;" id="assetRecoText">
                      Select an asset to see targeted recommendations (restart, service call, replacement, booking rule).
                    </div>
                  </div>
                  <div class="card" style="box-shadow:none; background: rgba(34,197,94,0.10); border:1px solid rgba(34,197,94,0.25);">
                    <div style="font-weight:950; font-size:12.5px;">Health Status</div>
                    <div class="muted" style="font-size:12.5px; margin-top:6px; line-height:1.6;" id="assetHealthText">
                      Select an asset to view health history, uptime, and recent issue trend.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div><!-- /Assets -->

          <!-- Employee -->
          <div class="view" id="view-employee" data-view="employee" role="tabpanel" aria-label="Employee View">
            <div id="employeeMount">
              <div class="card">
                <div class="card-head">
                  <div>
                    <div class="card-title">Employee Dashboard</div>
                    <div class="card-note">Mount your existing employee widgets here.</div>
                  </div>
                </div>
                <div class="muted" style="font-size:12.5px; line-height:1.6;">
                  (Placeholder) You can keep your previous Employee UI and inject it here.
                </div>
              </div>
            </div>
          </div>

          <!-- Manager -->
          <div class="view" id="view-manager" data-view="manager" role="tabpanel" aria-label="Manager View">
            <div id="managerMount">
              <div class="card">
                <div class="card-head">
                  <div>
                    <div class="card-title">Manager Dashboard</div>
                    <div class="card-note">Mount your existing manager widgets here.</div>
                  </div>
                </div>
                <div class="muted" style="font-size:12.5px; line-height:1.6;">
                  (Placeholder) You can keep your previous Manager UI and inject it here.
                </div>
              </div>
            </div>
          </div>
        </div><!-- /viewwrap -->
      </section>

      <!-- =========================
           SECTION: INCIDENT MGMT
           ========================= -->
      <section class="section" id="section-incident" aria-label="Incident Management Section">

        <!-- ✅ Replaced iframe with a clean "Open in new tab" button (Teams-friendly) -->
        <div class="card" style="padding:16px;">
          <div class="card-head" style="align-items:center;">
            <div>
              <div class="card-title" style="font-size:15px;">Incident Management</div>
              <div class="card-note">Opens the Sim Ticketing KB-Update console in a separate tab.</div>
            </div>

            <button
              class="btn"
              id="openIncidentBtn"
              type="button"
              onclick="window.open('incident/index.html','_blank','noopener')"
              aria-label="Open Incident Management in a new tab"
            >
              Open KB-Auto Update
            </button>
          </div>

          <div class="divider"></div>

          
        </div>
      </section>

      <footer class="footer">
        <div>© <span id="year"></span> Productivity Hub</div>
        <div class="footer-right">
          <span class="muted">Amazon office insights • Clean UI • Simple navigation</span>
        </div>
      </footer>
    </main>
  </div>

  <!-- ✅ FIX 2: body.incident-mode is controlled by this tiny inline script
       so you do NOT need to change your script.js if you don't want to. -->
  <script>
    (function () {
      const nav = document.getElementById("mainNav");
      if (!nav) return;

      function setIncidentMode(section) {
        document.body.classList.toggle("incident-mode", section === "incident");

        // Optional: update title/sub when switching modes (safe even if your script.js also updates it)
        const title = document.getElementById("pageTitle");
        const sub = document.getElementById("pageSub");
        if (title && sub) {
          if (section === "incident") {
            title.textContent = "Incident Management";
            sub.textContent = "Open the incident console in a separate tab (Teams-friendly).";
          } else {
            title.textContent = "Productivity";
            sub.textContent = "Employee, Manager, and Amazon office asset insights.";
          }
        }
      }

      // initial state (default productivity)
      setIncidentMode("productivity");

      // listen to nav clicks (won't break your existing script.js)
      nav.addEventListener("click", (e) => {
        const btn = e.target.closest(".side-item");
        if (!btn) return;
        const section = btn.dataset.section;
        if (!section) return;
        setIncidentMode(section);
      });
    })();
  </script>

  <script src="script.js"></script>
</body>
</html>

